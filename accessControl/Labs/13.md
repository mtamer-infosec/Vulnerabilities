# [Multi-step process with no access control on one step](https://portswigger.net/web-security/access-control/lab-multi-step-process-with-no-access-control-on-one-step)


**الهدف:** استغلال عملية متعددة الخطوات فيها خطوة واحدة بدون تحكم وصول صحيح لرفع صلاحيات مستخدم عادي إلى Administrator.
---

## 1) التحضير

- بيانات الدخول للوحة الإدارة (للتعرّف على الواجهة): `administrator:admin`.
    
- حساب الهدف الذي سنستخدمه للرفع: `wiener:peter`.
    
- الأدوات: Burp Suite (Proxy, Repeater), متصفح.
    

---

## 2) فهم العملية متعددة الخطوات

1. سجّلت الدخول كـ **administrator** لعرض واجهة Admin وكيف تعمل عملية تعديل الصلاحيات.
    
2. لاحظت أن تغيير صلاحية مستخدم يتضمن عدة طلبات (multi-step):
    
    - خطوة أولى (مثلاً): بدء عملية التعديل — يرسل خادم جلسة أو يهيئ عملية.
        
    - خطوة ثانية (مثلاً): تأكيد/تطبيق التغيير.
        
3. الفجوة: إحدى الخطوات **لا تتحقق** من هوية/صلاحية المستخدم (لا يوجد Access Control) — أي يمكن إعادة إرسالها بصلاحيات مختلفة أو بعد تبديل معطيات الطلب.
    

---

## 3) خطوات الاستغلال العملية (الخطوات التي قمت بها)

> ملاحظة: تصف الخطوات بأسلوب عام لتسهيل إعادة استخدام الملاحظة على لابات مشابهة.

1. **التقاط الطلبات بواسطة Burp**
    
    - أثناء وجودي كـ `administrator`, بدأت عملية تعديل صلاحية المستخدم `carlos` إلى `admin`.
        
    - أرسلت خطوة (الطلب الأول) إلى **Repeater** واحتفظت بنسخة الطلب والرد.
        
    - أرسلت خطوة التأكيد (الطلب الثاني) أيضاً إلى Repeater واحتفظت به.
        
2. **تسجيل الخروج وتسجيل الدخول كـ الهدف**
    
    - خرجت من حساب المدير.
        
    - سجلت الدخول باستخدام بيانات المستخدم العادي: `wiener:peter`.
        
    - التقطت جلسة (session token / cookie) الخاصة بالمستخدم `wiener`.
        
3. **تعديل الطلبات لإجراء الاستغلال**
    
    - أخذت الطلب / الخطوة الثانية (أو الخطوة التي تفتقد تحقق الصلاحيات) التي التقطتها أثناء وجودي كـ admin.
        
    - عدّلت الحقول ذات الصِلة (مثل `username` أو `targetUser` أو `role`) إلى `wiener` (أو عدّلت Session/Token بحيث يتم تطبيق الطلب على حساب `wiener`).
        
    - استبدلت الـ Cookie/Session في رأس الطلب بالـ session الخاصة بـ `wiener`، أو عدّلت الـ body/parameters لتوجيه العملية نحو `wiener`.
        
4. **إرسال الطلبات بالترتيب الصحيح**
    
    - أرسلت كل طلب بالترتيب الذي يلزم (الخطوة الأولية ثم التأكيد)، مستخدماً الطلبات المعدّلة بحيث تطبّق التغييرات على `wiener`.
    - 
        ![[Screenshot From 2025-10-17 22-44-34.png]]
		![[Screenshot From 2025-10-17 22-44-40.png]]

    - بعد تنفيذ الطلبات، تحققت من أن `wiener` أصبح يمتلك صلاحيات `administrator`.
        
5. **النتيجة**
    
    - الحساب `wiener` ارتفعت صلاحياته إلى Administrator وتمكنت من الوصول إلى لوحة الإدارة.
        

---
