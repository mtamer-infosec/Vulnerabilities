# [2FA broken logic](https://portswigger.net/web-security/authentication/multi-factor/lab-2fa-broken-logic)

> **الهدف**: تجاوز 2FA الضعيف والوصول إلى صفحة حساب `carlos`.

---

## ملخص سريع 

1. **طريقة brute-force لرمز 2FA**: أرسلت طلبات تحقق للـ endpoint الخاص بـ 2FA (verify) وعدّلت payload بحيث يجرب كل الأرقام الأربعة (0000..9999) عبر Intruder، لقيت الكود الصحيح ودخلت.
    
2. **طريقة تعديل معامل verify**: لاحظت أنّ الطلب فيه معامل `verify=carlos` — عدّلت القيمة لتشير إلى `carlos` ثم شغّلت هجوم لإيجاد الكود بنفس أسلوب الـ Intruder، وبذلك وصلت لصفحة الحساب.
    

---

## الخطوات

### تسجيل الدخول و الوصول لصفحة 2FA

1. سجِّل دخول أولاً بحسابك (مثلاً `wiener:peter`) 

2. عند إدخال اسم المستخدم وكلمة المرور ليوزر الضحية ستتوجَّه إلى صفحة تطلب رمز2FA    (`/login2` )
    
3. إيقاف الطلب الذي يرسل رمز التحقق (أو الطلب الذي يرسل كود 2FA) عبر Burp Intercept أو Repeater.
    
### تحويل الطلب إلى Intruder

1. من Intercept أو Repeater، اضغط **Send to Intruder** على الطلب الذي يتحقق من كود 2FA.
    
2. في Intruder عيّن الموضع الذي يمثل الكود كمكان Payload (مثلاً `1234` أو `code=1234`) — استخدم Position واحد لو بتجرب رموز.
    
3. و غير `verify=wiener`  الي كارلوس `verify=carlos` 

### الهجوم

- **Attack type**: `Sniper` (أفضل لو تختبر رقم واحد يتغيّر).
    
- **Payload type**: `Numbers` → Range `0` to `9999`، ثم اختَر `Pad` لتوليد 4 أرقام (مثلاً `0000`..`9999`). في Burp يمكنك استخدام Custom iterator أو قائمة مُنشأة مسبقًا.
    
- **Threads**: ابدأ بقيمة صغيرة (5-20) حسب استقرار السيرفر.

### تشغيل الهجوم وقراءة النتائج

1. شغّل الهجوم وراقب الأعمدة: **Status**, **Length**, **Response time**.
    
2. عادة الطلب الصحيح يميّز نفسه إما بـ `302` redirect إلى صفحة الحساب أو بتغيير `length` أو `status` أو `Location` header.
    
3. خذ النتيجة التي تختلف عن الباقي وجربها يدوياً في Repeater للتأكد.
    
### الدخول لصفحة الحساب

- عند الحصول على الكود الصحيح، استخدمه أو استخدم الكوكيز/redirect لفتح `/my-account?id=carlos` وتحقق من الوصول.
    

---
