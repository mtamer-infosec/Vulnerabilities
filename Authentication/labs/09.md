# [Password reset broken logic](https://portswigger.net/web-security/authentication/other-mechanisms/lab-password-reset-broken-logic)


> **الهدف**: استغلال خلل في منطق إعادة تعيين كلمة المرور (password reset) لتغيير كلمة مرور `carlos` ثم تسجيل الدخول إلى حسابه.

---

## 1) ملخص مختصر 

الطريقة تعتمد على أن سيرفر إعادة التعيين يستقبل توكن مؤقت (`temp-forgot-password-token`) مع حقول `username`, `new-password-1`, `new-password-2` ولكن لا يتحقق أن التوكن مرتبط باليوزر الموجود في الحقل `username`. بالتالي، لو حصلت على توكن صالح (مثلاً عن طريق طلب reset لليوزر الخاص بك)، تقدر ترسل نفس التوكن مع `username=carlos` وتغيّر باسورده مباشرة.

---

## 2) خطوات مرتبة قابلة للنسخ 

1. **اطلب إعادة تعيين كلمة مرور لحساب تملكه** (مثلاً `wiener`) عبر واجهة "Forgot password".
2. راقب الطلبات في Burp (Proxy Intercept) أو التقط الاستجابة التي تحتوي على التوكن المؤقت (أو الرابط المرسل عبر الإيميل في بيئة الاختبار).
3. ستجد شيئاً مثل:
   `temp-forgot-password-token=rnsg5smm30l7p8hgkkwd3pu243te5l7r&username=wiener&new-password-1=xxx&new-password-2=xxx`
4. **عدّل حقل `username` إلى `carlos`** 
5. ضع `new-password-1` و`new-password-2` بالقيمة التي تريد (مثلاً `main`).
6. أعد إرسال الطلب (POST). إذا نجح الخلل، سيقبل السيرفر التوكن ويبدّل كلمة مرور `carlos` إلى `main` دون تحقق من مطابقة التوكن للّيوزر.
7. سجّل دخول باستخدام `carlos:main` وافتح `/my-account?id=carlos` لإثبات النجاح.

---
